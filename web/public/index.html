<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MagicBox — 工具箱</title>
    <style>
      :root { color-scheme: dark; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; line-height: 1.6; background: #0b1021; color: #e5e7eb; min-height: 100vh; }
      header { position: sticky; top: 0; background: rgba(15, 23, 42, 0.92); border-bottom: 1px solid #1f2937; padding: 12px 24px; backdrop-filter: blur(6px); z-index: 10; }
      header .brand { font-weight: 700; letter-spacing: 0.05em; }
      main { max-width: 1200px; margin: 0 auto; padding: 24px; }
      h1 { margin: 0 0 12px; font-size: 22px; }
      h2 { margin: 0 0 16px; font-size: 18px; }
      .muted { color:#94a3b8; font-size: 13px; }
      .layout { display: grid; grid-template-columns: 240px 1fr; gap: 24px; align-items: start; }
      aside { border: 1px solid #1f2937; border-radius: 14px; background: linear-gradient(160deg, rgba(15, 23, 42, 0.95), rgba(17, 24, 39, 0.8)); box-shadow: 0 25px 50px -12px rgba(15, 23, 42, 0.8); padding: 18px; position: sticky; top: 96px; max-height: calc(100vh - 120px); overflow: auto; }
      .nav-title { font-size: 14px; text-transform: uppercase; letter-spacing: 0.08em; color: #64748b; margin-bottom: 12px; }
      .nav-list { list-style: none; margin: 0; padding: 0; display: grid; gap: 8px; }
      .nav-item { border: 1px solid transparent; border-radius: 10px; background: rgba(148, 163, 184, 0.05); color: inherit; padding: 10px 12px; text-align: left; font: inherit; cursor: pointer; transition: border-color 120ms, background 120ms; }
      .nav-item:hover { border-color: rgba(59, 130, 246, 0.35); }
      .nav-item[aria-selected="true"] { border-color: #2563eb; background: rgba(37, 99, 235, 0.15); box-shadow: inset 0 0 0 1px rgba(37, 99, 235, 0.4); }
      .panels { display: grid; gap: 18px; }
      .panel { display: none; border: 1px solid rgba(148, 163, 184, 0.12); border-radius: 14px; padding: 22px 24px; background: rgba(15, 23, 42, 0.88); box-shadow: 0 30px 60px -40px rgba(37, 99, 235, 0.65); }
      .panel.is-active { display: block; animation: fade-in 160ms ease-in; }
      label { display:block; margin: 12px 0 6px; font-weight: 600; color: #e2e8f0; }
      textarea, input, select { width: 100%; box-sizing: border-box; padding: 10px 12px; border: 1px solid #334155; background: #0b1226; color: #e5e7eb; border-radius: 10px; font-family: inherit; transition: border-color 120ms, box-shadow 120ms; }
      textarea:focus, input:focus, select:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.4); }
      button { margin-top: 12px; padding: 10px 16px; border: 1px solid #1d4ed8; background: linear-gradient(135deg, #2563eb, #1d4ed8); color: #fff; border-radius: 999px; cursor: pointer; font-weight: 600; letter-spacing: 0.02em; }
      button:disabled { opacity: .6; cursor: not-allowed; }
      pre { background: #0b1021; color: #e5e7eb; padding: 14px; border-radius: 10px; border: 1px solid rgba(30, 41, 59, 0.6); overflow: auto; }
      code { background: rgba(15, 23, 42, 0.5); padding: 0 6px; border-radius: 6px; }
      .row { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
      .translate-split { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
      .translate-options { margin-top: 16px; max-width: 260px; }
      .panel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
      .panel-options { margin-top: 16px; max-width: 260px; }
      .panel-options.inline { display: flex; gap: 12px; align-items: center; }
      .card { border: 1px solid rgba(148, 163, 184, 0.15); border-radius: 12px; padding: 16px; background: rgba(15, 23, 42, 0.55); box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.4); display: grid; gap: 12px; }
      .card h3 { margin: 0; font-size: 15px; }
      .timestamp-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin-bottom: 16px; }
      .timestamp-actions { display: flex; gap: 12px; margin-bottom: 12px; }
      .status-pill { display: inline-flex; align-items: center; gap: 6px; margin-top: 12px; padding: 6px 12px; border-radius: 999px; font-size: 13px; font-weight: 500; }
      .status-pill[data-state="success"] { background: rgba(34, 197, 94, 0.15); color: #86efac; border: 1px solid rgba(34, 197, 94, 0.35); }
      .status-pill[data-state="error"] { background: rgba(248, 113, 113, 0.12); color: #fca5a5; border: 1px solid rgba(248, 113, 113, 0.35); }
      .panel-header { display: flex; justify-content: space-between; align-items: baseline; gap: 16px; margin-bottom: 16px; }
      .panel-header small { color: #64748b; font-size: 12px; }
      a { color: #93c5fd; text-decoration: none; }
      a:hover { text-decoration: underline; }
      @media (max-width: 960px) {
        .layout { grid-template-columns: 1fr; }
        aside { position: static; max-height: none; }
      }
      @keyframes fade-in { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
    </style>
  </head>
  <body>
    <header>
      <div class="brand">MagicBox</div>
    </header>
    <main>
      <h1>MagicBox 工具台</h1>

      <div class="layout">
        <aside>
          <div class="nav-title">工具导航</div>
          <ul class="nav-list" role="tablist">
            <li><button class="nav-item" role="tab" data-panel="translate" aria-controls="panel-translate" aria-selected="true">翻译</button></li>
            <li><button class="nav-item" role="tab" data-panel="json" aria-controls="panel-json" aria-selected="false">JSON 格式化</button></li>
            <li><button class="nav-item" role="tab" data-panel="hash" aria-controls="panel-hash" aria-selected="false">哈希</button></li>
            <li><button class="nav-item" role="tab" data-panel="base64" aria-controls="panel-base64" aria-selected="false">Base64</button></li>
            <li><button class="nav-item" role="tab" data-panel="timestamp" aria-controls="panel-timestamp" aria-selected="false">时间戳</button></li>
          </ul>
        </aside>

        <div class="panels">
          <section class="panel is-active" id="panel-translate" role="tabpanel" aria-labelledby="panel-translate">
            <div class="panel-header">
              <h2>翻译</h2>
              <small>自动检测输入语种，只需选择目标语言</small>
            </div>
            <div class="row translate-split">
              <div>
                <label for="tText">输入文本</label>
                <textarea id="tText" rows="6">你好，世界</textarea>
              </div>
              <div>
                <label for="tOut">翻译结果</label>
                <textarea id="tOut" rows="6" readonly></textarea>
              </div>
            </div>
            <div class="translate-options">
              <label for="tTgt">目标语言</label>
              <select id="tTgt">
                <option value="en" selected>英文</option>
                <option value="zh">中文</option>
              </select>
            </div>
            <button id="btnTranslate">翻译</button>
          </section>

          <section class="panel" id="panel-json" role="tabpanel" aria-labelledby="panel-json">
            <div class="panel-header">
              <h2>JSON 格式化</h2>
              <small>粘贴原始 JSON，一键输出标准格式</small>
            </div>
            <div class="row">
              <div>
                <label for="jIn">JSON 输入</label>
                <textarea id="jIn" rows="6">{"a":1}</textarea>
              </div>
              <div>
                <label for="jOut">结果</label>
                <textarea id="jOut" rows="6" readonly></textarea>
              </div>
            </div>
            <button id="btnJson">格式化</button>
            <div id="jStatus" class="status-pill" aria-live="polite"></div>
          </section>

          <section class="panel" id="panel-hash" role="tabpanel" aria-labelledby="panel-hash">
            <div class="panel-header">
              <h2>哈希</h2>
              <small>选择算法生成不可逆摘要</small>
            </div>
            <div class="panel-grid">
              <div>
                <label for="hText">输入文本</label>
                <textarea id="hText" rows="4">hello</textarea>
              </div>
              <div>
                <label for="hOut">结果</label>
                <textarea id="hOut" rows="4" readonly></textarea>
              </div>
            </div>
            <div class="panel-options inline">
              <label for="hAlgo">算法</label>
              <select id="hAlgo">
                <option value="md5" selected>MD5</option>
                <option value="sha256">SHA-256</option>
              </select>
            </div>
            <button id="btnHash">计算</button>
          </section>

          <section class="panel" id="panel-base64" role="tabpanel" aria-labelledby="panel-base64">
            <div class="panel-header">
              <h2>Base64</h2>
              <small>对文本进行编码或解码</small>
            </div>
            <div class="panel-grid">
              <div>
                <label for="bText">输入文本</label>
                <textarea id="bText" rows="4">MagicBox</textarea>
              </div>
              <div>
                <label for="bOut">结果</label>
                <textarea id="bOut" rows="4" readonly></textarea>
              </div>
            </div>
            <div class="panel-options inline">
              <label for="bMode">操作</label>
              <select id="bMode">
                <option value="encode" selected>编码</option>
                <option value="decode">解码</option>
              </select>
            </div>
            <button id="btnBase64">执行</button>
          </section>

          <section class="panel" id="panel-timestamp" role="tabpanel" aria-labelledby="panel-timestamp">
            <div class="panel-header">
              <h2>时间戳</h2>
              <small>秒 / 毫秒 与 ISO 时间互转</small>
            </div>
            <div class="timestamp-grid">
              <div class="card">
                <h3>时间戳 ➜ 时间</h3>
                <label for="tsUnix">时间戳</label>
                <input id="tsUnix" placeholder="1700000000 或 1700000000000" />
                <div class="panel-options inline">
                  <label for="tsUnit">单位</label>
                  <select id="tsUnit">
                    <option value="seconds" selected>秒</option>
                    <option value="milliseconds">毫秒</option>
                  </select>
                </div>
                <button id="btnTsToTime">转换为时间</button>
              </div>
              <div class="card">
                <h3>日期时间 ➜ 时间戳</h3>
                <label for="tsLocal">日期时间</label>
                <input id="tsLocal" type="datetime-local" step="1" />
                <label for="tsTimezone">时区</label>
                <select id="tsTimezone">
                  <option value="local" data-tz="local" selected>系统本地</option>
                  <option value="UTC" data-tz="UTC">UTC (±00:00)</option>
                  <option value="+08:00" data-tz="Asia/Shanghai">Asia/Shanghai (+08:00)</option>
                  <option value="+09:00" data-tz="Asia/Tokyo">Asia/Tokyo (+09:00)</option>
                  <option value="+05:30" data-tz="Asia/Kolkata">Asia/Kolkata (+05:30)</option>
                  <option value="+01:00" data-tz="Europe/Berlin">Europe/Berlin (+01:00)</option>
                  <option value="-05:00" data-tz="America/New_York">America/New_York (-05:00)</option>
                </select>
                <button id="btnTsLocalToUnix">转换为时间戳</button>
                <div class="muted">默认使用当前系统时区，可手动调整</div>
              </div>
              <div class="card">
                <h3>ISO ➜ 时间戳</h3>
                <label for="tsIso">ISO-8601</label>
                <input id="tsIso" placeholder="2023-11-14T22:13:20Z" />
                <button id="btnTsIsoToUnix">转换为时间戳</button>
              </div>
            </div>
            <div class="timestamp-actions">
              <button id="btnTsNow">获取当前时间</button>
            </div>
            <label for="tsOutput">转换结果</label>
            <textarea id="tsOutput" rows="6" readonly></textarea>
          </section>
        </div>
      </div>
    </main>
    <script>
      const $ = (id) => document.getElementById(id);
      const navItems = Array.from(document.querySelectorAll('.nav-item'));
      const panels = Array.from(document.querySelectorAll('.panel'));

      const setActive = (panelId) => {
        navItems.forEach((btn) => btn.setAttribute('aria-selected', String(btn.dataset.panel === panelId)));
        panels.forEach((panel) => panel.classList.toggle('is-active', panel.id === `panel-${panelId}`));
      };

      navItems.forEach((btn) => {
        btn.addEventListener('click', () => setActive(btn.dataset.panel));
        btn.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            setActive(btn.dataset.panel);
          }
        });
      });

      const btnTranslate = $("btnTranslate");
      btnTranslate.onclick = async () => {
        const body = {
          text: $("tText").value,
          targetLang: $("tTgt").value,
        };
        $("tOut").value = "...";
        try {
          const res = await fetch('/api/tools/translate', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
          const data = await res.json();
          $("tOut").value = data.translation ?? JSON.stringify(data, null, 2);
        } catch (e) { $("tOut").value = String(e); }
      };

      const jsonStatus = document.getElementById('jStatus');
      const setJsonStatus = (state, message = '') => {
        if (!jsonStatus) return;
        jsonStatus.textContent = message;
        if (state) {
          jsonStatus.dataset.state = state;
          jsonStatus.style.display = 'inline-flex';
        } else {
          delete jsonStatus.dataset.state;
          jsonStatus.style.display = 'none';
        }
      };

      setJsonStatus(null);

      const btnJson = $("btnJson");
      btnJson.onclick = async () => {
        const body = { json: $("jIn").value };
        $("jOut").value = "...";
        setJsonStatus(null);
        try {
          const res = await fetch('/api/tools/json/format', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
          const data = await res.json();
          if (!res.ok) {
            const message = data?.message || `格式化失败（${res.status}）`;
            setJsonStatus('error', message);
            $("jOut").value = JSON.stringify(data, null, 2);
            return;
          }
          $("jOut").value = data.formatted ?? JSON.stringify(data, null, 2);
          setJsonStatus('success', '格式正确');
        } catch (e) {
          $("jOut").value = String(e);
          setJsonStatus('error', '请求失败，请稍后再试');
        }
      };

      const btnHash = $("btnHash");
      btnHash.onclick = async () => {
        const body = {
          text: $("hText").value,
          algorithm: $("hAlgo").value,
        };
        $("hOut").value = "...";
        try {
          const res = await fetch('/api/tools/hash', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
          const data = await res.json();
          if (!res.ok) {
            $("hOut").value = data?.message ?? JSON.stringify(data, null, 2);
            return;
          }
          $("hOut").value = data.digest ?? JSON.stringify(data, null, 2);
        } catch (e) { $("hOut").value = String(e); }
      };

      const btnBase64 = $("btnBase64");
      btnBase64.onclick = async () => {
        const body = {
          text: $("bText").value,
          action: $("bMode").value,
        };
        $("bOut").value = "...";
        try {
          const res = await fetch('/api/tools/base64', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
          const data = await res.json();
          if (!res.ok) {
            $("bOut").value = data?.message ?? JSON.stringify(data, null, 2);
            return;
          }
          $("bOut").value = data.result ?? JSON.stringify(data, null, 2);
        } catch (e) { $("bOut").value = String(e); }
      };

      const tsOutput = $("tsOutput");
      const tsLocalInput = $("tsLocal");
      const tsTimezone = $("tsTimezone");
      const tsIsoInput = $("tsIso");

      const toLocalInputValue = (date) => {
        const adjusted = new Date(date.getTime() - date.getTimezoneOffset() * 60000);
        return adjusted.toISOString().slice(0, 19);
      };

      const normalizeLocalValue = (value) => {
        if (!value) return value;
        const replaced = value.replace('T', ' ');
        return replaced.split(':').length === 2 ? `${replaced}:00` : replaced;
      };

      const hasExplicitOffset = (value) => /(?:Z|[+\-]\d{2}:?\d{2})$/i.test(value.trim());

      const setTimestampDefaults = () => {
        if (tsLocalInput) {
          tsLocalInput.value = toLocalInputValue(new Date());
        }
        if (tsIsoInput) {
          tsIsoInput.value = new Date().toISOString();
        }
        if (tsTimezone) {
          const inferred = Intl.DateTimeFormat().resolvedOptions().timeZone;
          if (inferred) {
            const option = Array.from(tsTimezone.options || []).find((opt) => opt.dataset.tz === inferred);
            tsTimezone.value = option ? option.value : 'local';
          } else {
            tsTimezone.value = 'local';
          }
        }
      };

      const callTimestamp = async (body) => {
        tsOutput.value = "...";
        try {
          const res = await fetch('/api/tools/timestamp', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
          const data = await res.json();
          if (!res.ok) {
            tsOutput.value = data?.message ?? JSON.stringify(data, null, 2);
            return;
          }
          tsOutput.value = JSON.stringify(data, null, 2);
        } catch (e) {
          tsOutput.value = String(e);
        }
      };

      $("btnTsNow").onclick = () => {
        setTimestampDefaults();
        callTimestamp({ mode: 'now' });
      };

      $("btnTsToTime").onclick = () => {
        callTimestamp({
          mode: 'fromUnix',
          value: $("tsUnix").value,
          unit: $("tsUnit").value,
        });
      };

      $("btnTsLocalToUnix").onclick = () => {
        const raw = tsLocalInput ? tsLocalInput.value : '';
        if (!raw) {
          tsOutput.value = '请先选择日期时间';
          return;
        }
        const payload = {
          mode: 'fromIso',
          value: normalizeLocalValue(raw),
        };
        const tzChoice = tsTimezone ? tsTimezone.value : 'local';
        if (tzChoice && tzChoice !== 'local') {
          payload.timezone = tzChoice;
        }
        callTimestamp(payload);
      };

      $("btnTsIsoToUnix").onclick = () => {
        const value = tsIsoInput ? tsIsoInput.value : '';
        if (!value) {
          tsOutput.value = '请填写 ISO 时间字符串';
          return;
        }
        const payload = {
          mode: 'fromIso',
          value,
        };
        const tzChoice = tsTimezone ? tsTimezone.value : 'local';
        if (!hasExplicitOffset(value) && tzChoice && tzChoice !== 'local') {
          payload.timezone = tzChoice;
        }
        callTimestamp(payload);
      };

      setTimestampDefaults();
      callTimestamp({ mode: 'now' });
    </script>
  </body>
  </html>
